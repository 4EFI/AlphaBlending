# Альфа блендинг 

## Постановка задачи

Задача заключается в том, чтобы совместить две картинки воедино. Звучит просто, так и есть. Самое сложное - раздобыть столь волшебную формулу:
```
  out_color.r = front_color.r * front_color.a + back_color.r * ( 1 - front_color.a )
  out_color.g = front_color.g * front_color.a + back_color.g * ( 1 - front_color.a ) 
  out_color.b = front_color.b * front_color.a + back_color.b * ( 1 - front_color.a ) 
  out_color.a = front_color.a                 + back_color.a * ( 1 - front_color.a ) 
```

<img align="top" src=img/cat_resize.bmp width="250px"/>
<img align="middle" src=img/table_resize.bmp width="600px"/>

Что это? Зачем это? У нас есть две картинки: back и front. Если бы они были в формате RGB, проблем бы никаких не было, мы просто 
соответствующий пиксель задней картинки заменяем на пиксель передней. Но как только у нас добавляется альфа канал, мы должны его учесть. Как его учесть, 
именно данная формула и показывает. 

То есть для каждого пикселя мы вычисляем новое значение и сохраняем его в выходной файл.

## Компиляция

Стоит отметить, что данный проект создавался на Linux и на других операционных системах процесс компиляции может завершиться ошибкой. Для того чтобы скомпилировать проект, вам потребуется библиотека SFML. Для Linux, пропишите команду:
~~~
sudo apt-get install libsfml-dev
~~~

После успешной установки библиотеки, клонируйте репозиторий к себе на компьютер: 
~~~
git clone https://github.com/4EFI/AlphaBlending.git
~~~

Можем перейти к компиляции, пропишите, находясь в главной директории проекта:
~~~
make clear
make    
~~~

## Запуск

Для того чтобы запустить исполняемый файл, пропишите:
~~~
./main
~~~

Если вы хотите протестировать программу с SSE, используйте следующую директиву в файле ./src/main.cpp
~~~
#define SSE
~~~

И выполните стадию компиляции, указанную выше. 

Также вы можете поставить нужные вам флаги оптимизации для компиляции. Для этого перейдите в SOURCES и добавьте их в переменную FFLAGS. 

## Представление

После запуска, вы получите следующую картинку:

<img src=img/result.png width="650px"/>

При альфа блендинге, мы пробегаемся по каждому пикселю, так как размер изображений не мал, и если взять слияние больше чем двух изображений, мы приходим к большому количеству вычислений. Для повышения скорости слияния двух картинок, воспользуемся SIMD инструкциями. Будем вычислять одновременно новый цвет сразу для 4 пикселей с помощью соответствующих интринсиков. 

Сведем все в общую таблицу:

Версия  | Флаги | FPS  | Коэфф. Ускорения |
--------|-------|------|------------------|
без SSE |  Нет  | 2.5  |       0.83       |
без SSE |  -O3  | 3.0  |       1.00       |
  SSE   |  Нет  | 4.1  |       1.36       |
  SSE   |  -O3  | 14.0 |       3.41       |

## Подведем итоги 

Мы получили ускорение программы в 3.4 раза при использовании SIMD с флагами оптимизации компилятора. Используя векторные инструкции в нашей программе обработки изображений, мы смогли добиться значительного повышения производительности по сравнению с реализациями без SSE. Этот подход преимущественен по сравнению с использованием исключительно флагов оптимизации компилятора.





